<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>魔法世界 - 章节</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 场景内容将通过JavaScript动态加载 -->
        <div id="scene-content"></div>
        
        <!-- 弹出提示框 -->
        <div id="hint-box" class="hint-box">
            <div id="hint-message"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // 游戏场景数据
        const scenes = {
            // 开始画面 (已在index.html中处理)
            
            // 章节1
            2101: {
                image: "画面01.jpg",
                text: "主人公Tom生活在魔法世界的魔法学校里，他每天都_____图书馆",
                buttons: [
                    { text: "打扫", position: "left", correct: true, nextScene: 2102 },
                    { text: "正在打扫", position: "right", correct: false, 
                      hint: "日常行为用一般现在时", nextScene: 2102 }
                ]
            },
            2102: {
                image: "画面02.jpg",
                text: "有一天，Tom发现他昨天_____的一个箱子今天被打开了，并且里面冒着蓝光。",
                buttons: [
                    { text: "锁上", position: "left", correct: true, nextScene: 2103 },
                    { text: "正在锁上", position: "right", correct: false, 
                      hint: "描述昨天发生的简单行为用一般过去时", nextScene: 2103 }
                ]
            },
            2103: {
                image: "画面03.jpg",
                text: "Tom好奇，走进一看，是个闪着蓝光的魔法棒，旁白有个标签，写着'时态魔法棒'。",
                buttons: [
                    { text: "继续", position: "center", correct: true, nextScene: 2104 }
                ]
            },
            2104: {
                image: "画面04.jpg",
                text: "Tom心生好奇，他把魔法棒藏在衣服里，明天一早_____户外试一下魔法棒的威力。",
                buttons: [
                    { text: "将去", position: "left", correct: true, nextScene: 2201 },
                    { text: "已经去", position: "right", correct: false, 
                      hint: "描述未来发生的简单行为用一般将来时", nextScene: 2201 }
                ]
            },
            
            // 章节2
            2201: {
                image: "画面05.jpg",
                text: "时间来到第二天早上，他_____着魔法扫帚飞往学习旁边的一个森林里。",
                buttons: [
                    { text: "正在骑", position: "left", correct: true, nextScene: 2202 },
                    { text: "已经骑", position: "right", correct: false, 
                      hint: "描述正在进行的行为用现在进行时", nextScene: 2203 }
                ]
            },
            2202: {
                image: "画面06.jpg",
                text: "昨天这个时候，Tom正_____图书馆，但他觉得这个魔法棒会很好玩，所以决定今天不去打扫图书馆了。",
                buttons: [
                    { text: "正在打扫", position: "left", correct: true, nextScene: 2203 },
                    { text: "已经打扫", position: "right", correct: false, 
                      hint: "描述过去正在进行的行为用过去进行时", nextScene: 2202 }
                ]
            },
            2203: {
                image: "画面07.jpg",
                text: "为了防止图书馆馆长Jimmy发现Tom偷懒，Tom将很早到达将图书馆进行_____。",
                buttons: [
                    { text: "打扫", position: "left", correct: true, nextScene: 2301 },
                    { text: "已经打扫", position: "right", correct: false, 
                      hint: "描述将来正在进行的行为用将来进行时", nextScene: 2301 }
                ]
            },
            
            // 章节3
            2301: {
                image: "画面08.jpg",
                text: "Tom停在了森林里的小溪旁边，然后从衣服里拿出【一般现在】魔法棒。他想，这魔法棒叫'时态'，难道启动它的咒语和时态有关？",
                buttons: [
                    { text: "拿出", position: "left", correct: true, nextScene: 2302 },
                    { text: "已经拿出", position: "right", correct: false, 
                      hint: "描述日常行为一般现在时", nextScene: 2302 }
                ]
            },
            2302: {
                image: "画面09.jpg",
                text: "于是，他决定结合在魔法学校学习的咒语试一下。<br>Tom用魔法棒指向小溪，念了一句：'一条香喷喷的鱼已经被烤熟了【现在完成】'。",
                buttons: [
                    { text: "已经被烤熟", position: "left", correct: true, nextScene: 2303 },
                    { text: "将来被烤熟", position: "right", correct: false, 
                      hint: "咒语未生效，请重新试", nextScene: 2302 }
                ]
            },
            2303: {
                image: "画面10.jpg",
                text: "只见念完咒语之后，突然一道蓝色闪光过后，一个用树枝做的烤架，上面有一条香喷喷的烤鱼出现在了Tom的面前。",
                buttons: [
                    { text: "继续", position: "center", correct: true, nextScene: 2304 }
                ]
            },
            2304: {
                image: "画面11.jpg",
                text: "Tom想，我来这之前，还没吃东西呢【过去完成】。正好可以包餐一顿。<br>Tom拿起吃了起来。",
                buttons: [
                    { text: "已经烤好的鱼", position: "left", correct: true, nextScene: 2305 },
                    { text: "将要烤好", position: "right", correct: false, 
                      hint: "描述已经完成的的行为用现在完成时", nextScene: 2305 }
                ]
            },
            2305: {
                image: "画面12.jpg",
                text: "Tom边吃边想，当我掌握了这根魔杖，那个总是欺负我的巫师就会被打败。【将来完成】。（By the time I have mastered this magic wand, the wizard who always bullies me will have been defeated.）",
                buttons: [
                    { text: "将会被打败", position: "left", correct: true, nextScene: 2401 },
                    { text: "已经被打败", position: "right", correct: false, 
                      hint: "描述将来完成的的行为用将来完成时", nextScene: 2401 }
                ]
            },
            
            // 章节4
            2401: {
                image: "画面13.jpg",
                text: "虽然Tom已经来到魔法学校_____一年时间【现在完成进行】，但是魔法的知识还是比不过巫师Mike。",
                buttons: [
                    { text: "学习了", position: "left", correct: true, nextScene: 2402 },
                    { text: "将学习", position: "right", correct: false, 
                      hint: "描述过去的行为持续到现在用现在完成进行", nextScene: 2402 }
                ]
            },
            2402: {
                image: "画面14.jpg",
                text: "Tom意识到了魔法棒的厉害之处，于是Tom来到了以前经常戏弄他的巫师Mike的家里。<br>Tom说：'Mike，现在我_____魔法打败你了，你出来接受我的挑战吧'",
                buttons: [
                    { text: "可以用", position: "left", correct: true, nextScene: 2403 },
                    { text: "正在用", position: "right", correct: false, 
                      hint: "描述正在进行的行为用现在进行时", nextScene: 2403 }
                ]
            },
            2403: {
                image: "画面15.jpg",
                text: "今天是个阳光明媚的日子，只见Mike带着一个大大的灰色巫师帽从房间里走了出来，说到'Tom，在过去的一年时间里，已经多次_____我了【过去完成进行时】。（You had been repeatedly losing to me over the past year.）还是不服输吗'",
                buttons: [
                    { text: "输给", position: "left", correct: true, nextScene: 2404 },
                    { text: "将输给", position: "right", correct: false, 
                      hint: "描述正在进行的行为用现在进行时", nextScene: 2404 }
                ]
            },
            2404: {
                image: "画面16.jpg",
                text: "只见Tom用魔法棒指向天空，用咒语说了一句：'It's going to rain soon'，魔法棒发出来蓝光。",
                buttons: [
                    { text: "继续", position: "center", correct: true, nextScene: 2405 }
                ]
            },
            2405: {
                image: "画面17.jpg",
                text: "果然，不一会儿天空出现了乌云，打起了雷，开始下起了下雨点。",
                buttons: [
                    { text: "继续", position: "center", correct: true, nextScene: 2406 }
                ]
            },
            2406: {
                image: "画面18.jpg",
                text: "Mike看见后下了一跳，说到：'到明天为止，我已经学了魔法2年了【将来完成进行时】（By tomorrow, I have been studying magic for 2 years now）。却从来没看过这么厉害的魔法，我承认你已经比我厉害了'",
                buttons: [
                    { text: "已经学了", position: "left", correct: true, nextScene: 2407 },
                    { text: "将要学", position: "right", correct: false, 
                      hint: "描述将来完成进行时", nextScene: 2407 }
                ]
            },
            2407: {
                image: "画面19.jpg",
                text: "Tom想再炫耀一下魔法棒的威力，准备念出下一个咒语时，突然一道光闪过，图书馆馆长Jimmy出现在面前。",
                buttons: [
                    { text: "继续", position: "center", correct: true, nextScene: 2408 }
                ]
            },
            2408: {
                image: "画面20.jpg",
                text: "馆长说到：'Tom，我找了它找了一整天，原来被你拿走了'。",
                buttons: [
                    { text: "找了", position: "left", correct: true, nextScene: 2409 },
                    { text: "将找", position: "right", correct: false, 
                      hint: "描述过去完成", nextScene: 2409 }
                ]
            },
            2409: {
                image: "画面21.jpg",
                text: "Jimmy举起手，魔法棒自动飞到Jimmy的手里。然后，Jimmy领着Tom，说道'赶紧回去给我打扫图书馆'.....",
                buttons: [
                    { text: "继续", position: "center", correct: true, nextScene: 2410 }
                ]
            },
            2410: {
                image: "画面22.jpg",
                text: "显示排行榜",
                isEnd: true
            }
        };

        // 获取当前场景ID
        const urlParams = new URLSearchParams(window.location.search);
        let currentSceneId = urlParams.get('scene') || '2101';
        
        // 加载场景
        function loadScene(sceneId) {
            const scene = scenes[sceneId];
            const sceneContent = document.getElementById('scene-content');
            
            if (!scene) {
                sceneContent.innerHTML = '<div class="error">场景加载错误，请刷新页面</div>';
                return;
            }
            
            // 如果是结束场景，显示结果
            if (scene.isEnd) {
                showResults();
                return;
            }
            
            // 构建场景HTML
            let html = `
                <img src="images/${scene.image}" alt="游戏场景" class="game-image">
                <div class="scene-text">${scene.text}</div>
                <div class="buttons-container">
            `;
            
            // 添加按钮
            scene.buttons.forEach(button => {
                const positionClass = button.position === 'left' ? 'left-button' : 
                                    button.position === 'right' ? 'right-button' : 'center-button';
                
                html += `
                    <button class="action-button ${positionClass}" 
                            data-correct="${button.correct}" 
                            data-next="${button.nextScene}"
                            data-hint="${button.hint || ''}">
                        ${button.text}
                    </button>
                `;
            });
            
            html += `</div>`;
            sceneContent.innerHTML = html;
            
            // 添加按钮事件监听
            document.querySelectorAll('.action-button').forEach(button => {
                button.addEventListener('click', function() {
                    const isCorrect = this.getAttribute('data-correct') === 'true';
                    const nextScene = this.getAttribute('data-next');
                    const hint = this.getAttribute('data-hint');
                    
                    // 更新分数
                    if (isCorrect) {
                        updateScore(6.7);
                    }
                    
                    // 显示提示（如果有）
                    if (hint) {
                        showHint(hint);
                    }
                    
                    // 跳转到下一个场景
                    if (!hint || hint && isCorrect) {
                        setTimeout(() => {
                            window.location.href = `chapter.html?scene=${nextScene}`;
                        }, hint ? 3000 : 0);
                    }
                });
            });
        }
        
        // 显示提示
        function showHint(message) {
            const hintBox = document.getElementById('hint-box');
            const hintMessage = document.getElementById('hint-message');
            
            hintMessage.innerHTML = message;
            hintBox.style.display = 'block';
            
            setTimeout(() => {
                hintBox.style.display = 'none';
            }, 3000);
        }
        
        // 更新分数
        function updateScore(points) {
            const currentScore = parseFloat(localStorage.getItem('score') || 0;
            localStorage.setItem('score', (currentScore + points).toString());
        }
        
        // 显示结果
        function showResults() {
            const gameStartTime = parseInt(localStorage.getItem('gameStartTime'));
            const currentTime = new Date().getTime();
            const timeSpent = Math.floor((currentTime - gameStartTime) / 1000); // 秒
            
            // 计算时间分数
            const minutes = Math.floor(timeSpent / 60);
            const timeScore = minutes * 2 + (timeSpent % 60 > 0 ? 1 : 0);
            
            // 获取答题分数
            const answerScore = parseFloat(localStorage.getItem('score')) || 0;
            
            // 计算总分
            const totalScore = Math.max(0, answerScore - timeScore);
            
            // 计算正确率
            const correctRate = (answerScore / (6.7 * 15) * 100).toFixed(1);
            
            // 显示结果
            document.getElementById('scene-content').innerHTML = `
                <div class="results-container">
                    <h2>游戏结束</h2>
                    <img src="images/画面22.jpg" alt="游戏结果" class="result-image">
                    <div class="result-item">正确率: <span>${correctRate}%</span></div>
                    <div class="result-item">用时: <span>${formatTime(timeSpent)}</span></div>
                    <div class="result-item">总得分: <span>${totalScore.toFixed(1)}</span></div>
                    <button id="restart-button" class="main-button">重新开始</button>
                </div>
            `;
            
            // 重新开始按钮
            document.getElementById('restart-button').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
        }
        
        // 格式化时间显示
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}分${secs}秒`;
        }
        
        // 初始化加载当前场景
        loadScene(currentSceneId);
    </script>
</body>
</html>
