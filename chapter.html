<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Tense Game - Chapters</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
</head>
<body>
    <div id="game-container">
        <!-- All chapter pages will be loaded here dynamically -->
    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <p id="alert-message"></p>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHRYTBU74r31MPYVAAnRMwKM76c_-BduQ",
            authDomain: "tetrisonline-ca400.firebaseapp.com",
            projectId: "tetrisonline-ca400",
            storageBucket: "tetrisonline-ca400.firebasestorage.app",
            messagingSenderId: "58207939196",
            appId: "1:58207939196:web:b34f403204096084ee37f9",
            measurementId: "G-GG7GNEQ718"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // Game state variables
        let currentRoomId = null;
        let playerId = null;
        let playerNickname = null;
        let isTeacher = false;
        let gameStartTime = null;
        let timerInterval = null;
        let correctAnswers = 0;
        let currentPageId = null;
        let nextImagePreloaded = false;

        // DOM elements
        const gameContainer = document.getElementById('game-container');
        const alertModal = document.getElementById('alert-modal');
        const alertMessage = document.getElementById('alert-message');

        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        currentRoomId = urlParams.get('room');
        playerId = urlParams.get('player');
        playerNickname = decodeURIComponent(urlParams.get('nickname') || '');
        isTeacher = urlParams.get('teacher') === 'true';

        // Initialize game
        if (isTeacher) {
            // Teacher goes directly to leaderboard
            loadLeaderboardPage();
        } else {
            // Player starts the game
            initializePlayerGame();
        }

        // Initialize player game
        function initializePlayerGame() {
            // Record game start time
            gameStartTime = Date.now();
            
            // Start timer to update player stats periodically
            timerInterval = setInterval(updatePlayerStats, 5000); // Update every 5 seconds
            
            // Load the first chapter page
            loadPage('2101');
        }

        // Update player stats in Firebase
        function updatePlayerStats() {
            if (!currentRoomId || !playerId) return;
            
            const currentTime = Date.now();
            const elapsedSeconds = Math.floor((currentTime - gameStartTime) / 1000);
            const progress = calculateProgress();
            
            const playerRef = database.ref(`rooms/${currentRoomId}/players/${playerId}`);
            playerRef.update({
                nickname: playerNickname,
                correctAnswers: correctAnswers,
                elapsedTime: elapsedSeconds,
                progress: progress,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP
            }).catch((error) => {
                console.error('Error updating player stats:', error);
            });
        }

        // Calculate current progress (1-21)
        function calculateProgress() {
            if (!currentPageId) return 0;
            
            const pageNumber = parseInt(currentPageId.substring(1));
            return Math.floor((pageNumber - 2100) / 100) + 1; // Returns 1-21
        }

        // Load a specific page
        function loadPage(pageId) {
            currentPageId = pageId;
            
            // Update player stats
            updatePlayerStats();
            
            // Clear existing content
            gameContainer.innerHTML = '';
            
            // Create new page element
            const pageElement = document.createElement('div');
            pageElement.id = `page-${pageId}`;
            pageElement.className = 'game-page active';
            
            // Load page content based on pageId
            switch (pageId) {
                // Chapter 1
                case '2101': loadPage2101(pageElement); break;
                case '2102': loadPage2102(pageElement); break;
                case '2103': loadPage2103(pageElement); break;
                case '2104': loadPage2104(pageElement); break;
                // Chapter 2
                case '2201': loadPage2201(pageElement); break;
                case '2202': loadPage2202(pageElement); break;
                case '2203': loadPage2203(pageElement); break;
                // Chapter 3
                case '2301': loadPage2301(pageElement); break;
                case '2302': loadPage2302(pageElement); break;
                case '2303': loadPage2303(pageElement); break;
                case '2304': loadPage2304(pageElement); break;
                case '2305': loadPage2305(pageElement); break;
                // Chapter 4
                case '2401': loadPage2401(pageElement); break;
                case '2402': loadPage2402(pageElement); break;
                case '2403': loadPage2403(pageElement); break;
                case '2404': loadPage2404(pageElement); break;
                case '2405': loadPage2405(pageElement); break;
                case '2406': loadPage2406(pageElement); break;
                case '2407': loadPage2407(pageElement); break;
                case '2408': loadPage2408(pageElement); break;
                case '2409': loadPage2409(pageElement); break;
                // Leaderboard
                case '2501': loadLeaderboardPage(pageElement); break;
                default: 
                    console.error('Unknown page ID:', pageId);
                    return;
            }
            
            // Add page to container
            gameContainer.appendChild(pageElement);
            
            // Preload next possible image
            preloadNextImage(pageId);
        }

        // Preload next possible image
        function preloadNextImage(currentPageId) {
            if (nextImagePreloaded) return;
            
            const nextPageId = getNextPageId(currentPageId);
            if (!nextPageId) return;
            
            const imagePath = getImagePathForPage(nextPageId);
            if (!imagePath) return;
            
            const img = new Image();
            img.src = imagePath;
            nextImagePreloaded = true;
        }

        // Get next page ID based on current page
        function getNextPageId(currentPageId) {
            switch (currentPageId) {
                case '2101': return '2102';
                case '2102': return '2103';
                case '2103': return '2104';
                case '2104': return '2201';
                case '2201': return '2202';
                case '2202': return '2203';
                case '2203': return '2301';
                case '2301': return '2302';
                case '2302': return '2304'; // Skips 2303 which is just a continue page
                case '2303': return '2304';
                case '2304': return '2305';
                case '2305': return '2401';
                case '2401': return '2402';
                case '2402': return '2403';
                case '2403': return '2404';
                case '2404': return '2405';
                case '2405': return '2406';
                case '2406': return '2407';
                case '2407': return '2408';
                case '2408': return '2409';
                case '2409': return '2501';
                default: return null;
            }
        }

        // Get image path for a page
        function getImagePathForPage(pageId) {
            if (pageId === '2501') return null; // Leaderboard has no image
            
            const pageNumber = pageId.substring(1);
            return `images/画面${pageNumber}.jpg`;
        }

        // Show alert modal
        function showAlert(message, duration = 3000) {
            alertMessage.textContent = message;
            alertModal.style.display = 'flex';
            
            if (duration > 0) {
                setTimeout(() => {
                    alertModal.style.display = 'none';
                }, duration);
            }
        }

        // Hide alert modal
        function hideAlert() {
            alertModal.style.display = 'none';
        }

        // Calculate player score
        function calculateScore() {
            const currentTime = Date.now();
            const elapsedSeconds = Math.floor((currentTime - gameStartTime) / 1000);
            const elapsedMinutes = Math.ceil(elapsedSeconds / 60);
            
            // Time score: 2 points per full minute, 1 point for partial minute
            const timeScore = elapsedMinutes * 2 - (elapsedSeconds % 60 === 0 ? 0 : 1);
            
            // Correct answer score: 6.7 points per correct answer
            const answerScore = correctAnswers * 6.7;
            
            // Total score (max 100)
            let totalScore = Math.round(answerScore - timeScore);
            totalScore = Math.max(0, Math.min(100, totalScore));
            
            // Accuracy
            const accuracy = (correctAnswers / 15 * 100).toFixed(1);
            
            return {
                totalScore: totalScore,
                accuracy: accuracy,
                elapsedSeconds: elapsedSeconds
            };
        }

        // Load leaderboard page
        function loadLeaderboardPage(pageElement) {
            if (!pageElement) {
                // Create new page if not provided
                pageElement = document.createElement('div');
                pageElement.id = 'page-2501';
                pageElement.className = 'game-page active';
                gameContainer.innerHTML = '';
                gameContainer.appendChild(pageElement);
            }
            
            // Clear timer if player
            if (!isTeacher) {
                clearInterval(timerInterval);
                
                // Calculate final score and update Firebase
                const scoreData = calculateScore();
                updatePlayerFinalScore(scoreData);
            }
            
            // Leaderboard HTML
            pageElement.innerHTML = `
                <div class="leaderboard-container">
                    <h2>Room: ${currentRoomId}</h2>
                    <p id="player-count">Loading players...</p>
                    <div class="leaderboard-table-container">
                        <table id="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Score</th>
                                    <th>Accuracy</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <!-- Player rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // Load and display leaderboard data
            loadLeaderboardData();
        }

        // Update player's final score in Firebase
        function updatePlayerFinalScore(scoreData) {
            if (!currentRoomId || !playerId) return;
            
            const playerRef = database.ref(`rooms/${currentRoomId}/players/${playerId}`);
            playerRef.update({
                nickname: playerNickname,
                score: scoreData.totalScore,
                accuracy: scoreData.accuracy,
                elapsedTime: scoreData.elapsedSeconds,
                completed: true,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP
            }).catch((error) => {
                console.error('Error updating final score:', error);
            });
        }

        // Load leaderboard data from Firebase
        function loadLeaderboardData() {
            if (!currentRoomId) return;
            
            const roomRef = database.ref('rooms/' + currentRoomId);
            roomRef.on('value', (snapshot) => {
                const roomData = snapshot.val();
                if (!roomData || !roomData.players) {
                    document.getElementById('player-count').textContent = 'No players found';
                    return;
                }
                
                // Convert players object to array and filter out teachers/incomplete players
                const players = Object.entries(roomData.players)
                    .map(([id, player]) => ({ id, ...player }))
                    .filter(player => player.score !== undefined && player.completed);
                
                // Update player count
                document.getElementById('player-count').textContent = `Players: ${players.length}`;
                
                // Sort players by score (descending)
                players.sort((a, b) => b.score - a.score);
                
                // Display top 10 players
                const leaderboardBody = document.getElementById('leaderboard-body');
                leaderboardBody.innerHTML = '';
                
                players.slice(0, 10).forEach((player, index) => {
                    const row = document.createElement('tr');
                    if (player.id === playerId) {
                        row.classList.add('highlight-player');
                    }
                    
                    // Format time (mm:ss)
                    const minutes = Math.floor(player.elapsedTime / 60);
                    const seconds = player.elapsedTime % 60;
                    const timeString = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                    
                    row.innerHTML = `
                        <td>${player.nickname || 'Anonymous'}</td>
                        <td>${player.score}</td>
                        <td>${player.accuracy}%</td>
                        <td>${timeString}</td>
                    `;
                    
                    leaderboardBody.appendChild(row);
                });
            });
        }

        // Helper function to create button with click handler
        function createButton(text, position, isCorrect, nextPageId, hint) {
            const button = document.createElement('button');
            button.className = `game-btn ${position}`;
            button.textContent = text;
            
            button.addEventListener('click', function() {
                // Disable button after click to prevent multiple clicks
                button.disabled = true;
                
                // Update correct answers count if this was a correct answer
                if (isCorrect) {
                    correctAnswers++;
                    updatePlayerStats();
                }
                
                // Show hint if this was a wrong answer
                if (hint) {
                    showAlert(hint);
                }
                
                // Load next page after delay if there's a hint
                setTimeout(() => {
                    loadPage(nextPageId);
                }, hint ? 3000 : 0);
            });
            
            return button;
        }

        // Helper function to create continue button
        function createContinueButton(nextPageId) {
            const button = document.createElement('button');
            button.className = 'game-btn center';
            button.textContent = 'Continue';
            
            button.addEventListener('click', function() {
                button.disabled = true;
                loadPage(nextPageId);
            });
            
            return button;
        }

        // Helper function to create game over button
        function createGameOverButton() {
            const button = document.createElement('button');
            button.className = 'game-btn center';
            button.textContent = 'Game over';
            
            button.addEventListener('click', function() {
                button.disabled = true;
                loadLeaderboardPage();
            });
            
            return button;
        }

        // Page loading functions for each page
        function loadPage2101(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面01.jpg" alt="Page 01" class="full-width-image">
                <div class="text-box">
                    <p>Tom lives in a magical world and ____ the school library every day.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('cleans', 'left', true, '2102'));
            buttonContainer.appendChild(createButton('cleaning', 'right', false, '2102', 
                'Daily behavior is expressed in the present tense'));
        }

        function loadPage2102(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面02.jpg" alt="Page 02" class="full-width-image">
                <div class="text-box">
                    <p>Tom found that a box he _____ yesterday has been opened today, and there is blue light coming from inside.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('locked', 'left', true, '2103'));
            buttonContainer.appendChild(createButton('locks', 'right', false, '2103', 
                'Describe the simple behavior that occurred yesterday in the past simple tense'));
        }

        function loadPage2103(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面03.jpg" alt="Page 03" class="full-width-image">
                <div class="text-box">
                    <p>Tom walked over curiously and saw a magic wand with a flashing blue light, with a label next to it that read: Tense Magic wand.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createContinueButton('2104'));
        }

        function loadPage2104(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面04.jpg" alt="Page 04" class="full-width-image">
                <div class="text-box">
                    <p>Tom became curious and hid his magic wand in his clothes before taking it away from the library He ____ outdoors tomorrow to test the power of the magic wand.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('will go', 'left', true, '2201'));
            buttonContainer.appendChild(createButton('is going', 'right', false, '2201', 
                'Describe simple behaviors that will occur in the future using general future tense'));
        }

        function loadPage2201(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面05.jpg" alt="Page 05" class="full-width-image">
                <div class="text-box">
                    <p>The next morning, he ____ a magic broom towards a forest next to the school.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('is riding', 'left', true, '2202'));
            buttonContainer.appendChild(createButton('has ridden', 'right', false, '2202', 
                'Describe the ongoing behavior in present continuous tense'));
        }

        function loadPage2202(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面06.jpg" alt="Page 06" class="full-width-image">
                <div class="text-box">
                    <p>At this time yesterday, Tom was cleaning the library. He was supposed to be organizing books in the library today, but he thought this magic wand would be fun. So I decided to slack off and not go to the library anymore.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('was cleaning', 'left', true, '2203'));
            buttonContainer.appendChild(createButton('is cleaning', 'right', false, '2203', 
                '描述过去正在进行的行为用过去进行时'));
        }

        function loadPage2203(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面07.jpg" alt="Page 07" class="full-width-image">
                <div class="text-box">
                    <p>Tom will be tidying up the library early tomorrow to prevent library director Jimmy from discovering his laziness.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('will be tidying up', 'left', true, '2301'));
            buttonContainer.appendChild(createButton('is tidying up', 'right', false, '2301', 
                'Describe the ongoing behavior in the future using future continuous tense'));
        }

        function loadPage2301(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面08.jpg" alt="Page 08" class="full-width-image">
                <div class="text-box">
                    <p>Tom stops by the stream in the forest and ____ the magic wand from his clothes. He thought that the magic wand is called a tense magic wand. Is the spell that activates it related to tense?</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('takes out', 'left', true, '2302'));
            buttonContainer.appendChild(createButton('will take out', 'right', false, '2302', 
                'Describe daily behavior in the present tense'));
        }

        function loadPage2302(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面09.jpg" alt="Page 09" class="full-width-image">
                <div class="text-box">
                    <p>So he decided to try combining the spells he learned at the magic school. Tom pointed his magic wand at the stream and said, 'A delicious fish has been grilled.'</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('has been grilled', 'left', true, '2304'));
            buttonContainer.appendChild(createButton('will be grilled', 'right', false, '2304', 
                'The spell didn\'t take effect, Tom recited a delicious fish that had already been grilled'));
        }

        function loadPage2303(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面10.jpg" alt="Page 10" class="full-width-image">
                <div class="text-box">
                    <p>After reciting the spell, a sudden blue flash appeared. Then a grill made of tree branches appeared in front of Tom, with a fragrant grilled fish on top.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createContinueButton('2304'));
        }

        function loadPage2304(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面11.jpg" alt="Page 11" class="full-width-image">
                <div class="text-box">
                    <p>Tom hadn't had breakfast before coming here, and his stomach was growling. Tom ____ the grilled fish and begins eating.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('has taken', 'left', true, '2305'));
            buttonContainer.appendChild(createButton('will take', 'right', false, '2305', 
                'Describe completed actions in present perfect tense'));
        }

        function loadPage2305(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面12.jpg" alt="Page 12" class="full-width-image">
                <div class="text-box">
                    <p>Tom thinks that now he has the powerful wand. And the wizard who always bullies me will have been defeated by him.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('will have been defeated', 'left', true, '2401'));
            buttonContainer.appendChild(createButton('has been defeated', 'right', false, '2401', 
                'Describe the behavior to be completed in the future using the future perfect tense'));
        }

        function loadPage2401(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面13.jpg" alt="Page 13" class="full-width-image">
                <div class="text-box">
                    <p>Although Tom has been studying magic at the school for a year, his knowledge of magic is still inferior to that of wizard Mike.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('has been studying', 'left', true, '2402'));
            buttonContainer.appendChild(createButton('will studying', 'right', false, '2402', 
                'The action has been ongoing from the past to the present, and may have just ended or is still ongoing, using the present to complete the ongoing tense'));
        }

        function loadPage2402(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面14.jpg" alt="Page 14" class="full-width-image">
                <div class="text-box">
                    <p>So Tom came to the house of the wizard Mike who used to tease him. Tom shouted at Mike, 'I ____ magic to defeat you. Come out and accept my challenge.'</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('will use', 'left', true, '2403'));
            buttonContainer.appendChild(createButton('am using', 'right', false, '2403', 
                'Describe future actions using future continuous tense'));
        }

        function loadPage2403(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面15.jpg" alt="Page 15" class="full-width-image">
                <div class="text-box">
                    <p>Mike walked out of the room and said, 'Tom, you had been repeatedly losing to me over the past year. Are you still not willing to give up?'</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('had been repeatedly losing', 'left', true, '2404'));
            buttonContainer.appendChild(createButton('was losing', 'right', false, '2404', 
                'A certain past action started earlier in the past and continued until a certain point in time, possibly still continuing or just stopped'));
        }

        function loadPage2404(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面16.jpg" alt="Page 16" class="full-width-image">
                <div class="text-box">
                    <p>Tom pointed his magic wand at the sky and cursed 'It\'s going to rain soon,' and the wand emitted blue light.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createContinueButton('2405'));
        }

        function loadPage2405(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面17.jpg" alt="Page 17" class="full-width-image">
                <div class="text-box">
                    <p>Before long, dark clouds appeared in the sky, thunder started to strike, and raindrops began to fall.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createContinueButton('2406'));
        }

        function loadPage2406(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面18.jpg" alt="Page 18" class="full-width-image">
                <div class="text-box">
                    <p>By tomorrow, Mike ____ magic for 2 years now. But Mike was still stunned when he saw Tom's magic. Mike had never seen such a powerful magic before and said to Tom, 'I admit you're already better than me.'</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('will have been studying', 'left', true, '2407'));
            buttonContainer.appendChild(createButton('will be studying', 'right', false, '2407', 
                'Emphasize how long a certain action has been ongoing until a certain point in the future, using the future completion continuous time'));
        }

        function loadPage2407(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面19.jpg" alt="Page 19" class="full-width-image">
                <div class="text-box">
                    <p>Tom wants to show off the power of his magic wand again and is ready to recite the next spell. But suddenly a beam of light flashed and the library director Jimmy appeared in front of him.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createContinueButton('2408'));
        }

        function loadPage2408(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面20.jpg" alt="Page 20" class="full-width-image">
                <div class="text-box">
                    <p>Library director Jimmy said to Tom, 'I've been looking for it all day, but you took it away.'.</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createButton('have been looking', 'left', true, '2409'));
            buttonContainer.appendChild(createButton('am looking', 'right', false, '2409', 
                'Describe actions that have been completed in the past and use them to complete them'));
        }

        function loadPage2409(pageElement) {
            pageElement.innerHTML = `
                <img src="images/画面21.jpg" alt="Page 21" class="full-width-image">
                <div class="text-box">
                    <p>Jimmy raised his hand, and the magic wand automatically flew into Jimmy's hand. Then Jimmy shouted at Tom, 'Hurry back and clean the library for me.'</p>
                </div>
                <div class="button-container">
                    <!-- Buttons will be added dynamically -->
                </div>
            `;
            
            const buttonContainer = pageElement.querySelector('.button-container');
            buttonContainer.appendChild(createGameOverButton());
        }
    </script>
</body>
</html>
