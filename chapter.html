<!DOCTYPE html> 
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时态魔法冒险 - 章节</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 游戏主容器 -->
    <div id="game-container" class="screen">
        <!-- 背景图片 -->
        <img id="background-image" src="" alt="游戏背景" class="background-image">
        
        <!-- 文本内容 -->
        <div id="text-content" class="text-content"></div>
        
        <!-- 按钮容器 -->
        <div id="buttons-container" class="buttons-container"></div>
        
        <!-- 提示框 -->
        <div id="hint-box" class="hint-box"></div>
        
        <!-- 继续按钮 (全屏) -->
        <button id="continue-button" class="fullscreen-button">继续</button>
    </div>

    <!-- 结束画面 -->
    <div id="end-screen" class="screen hidden">
        <div class="result-container">
            <h1>游戏结束</h1>
            <div class="result-item">
                <span class="result-label">正确率:</span>
                <span id="accuracy" class="result-value">0%</span>
            </div>
            <div class="result-item">
                <span class="result-label">用时:</span>
                <span id="time-used" class="result-value">0分0秒</span>
            </div>
            <div class="result-item">
                <span class="result-label">总得分:</span>
                <span id="total-score" class="result-value">0</span>
            </div>
            <button id="restart-button" class="restart-button">重新开始</button>
        </div>
    </div>

    <script>
        // 游戏数据
        const gameData = {
            // 当前分数
            score: 0,
            // 正确答题数
            correctAnswers: 0,
            // 开始时间
            startTime: null,
            // 结束时间
            endTime: null,
            // 当前场景ID
            currentSceneId: null,
            
            // 初始化游戏
            init() {
                // 设置开始时间
                this.startTime = new Date();
                
                // 从URL获取初始场景ID
                const hash = window.location.hash.substring(1);
                this.currentSceneId = hash || '2101';
                
                // 加载场景
                this.loadScene(this.currentSceneId);
                
                // 设置重新开始按钮事件
                document.getElementById('restart-button').addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
            },
            
            // 加载场景
            loadScene(sceneId) {
                const scene = scenes[sceneId];
                if (!scene) {
                    console.error(`场景 ${sceneId} 不存在`);
                    return;
                }
                
                // 更新当前场景ID
                this.currentSceneId = sceneId;
                window.location.hash = sceneId;
                
                // 设置背景图片
                const bgImage = document.getElementById('background-image');
                bgImage.src = `images/画面${scene.backgroundImageId}.jpg`;
                bgImage.style.opacity = '0';
                setTimeout(() => {
                    bgImage.style.opacity = '1';
                }, 50);
                
                // 设置文本内容
                document.getElementById('text-content').textContent = scene.text;
                
                // 清除之前的按钮和提示
                document.getElementById('buttons-container').innerHTML = '';
                document.getElementById('hint-box').textContent = '';
                document.getElementById('hint-box').style.display = 'none';
                document.getElementById('continue-button').style.display = 'none';
                
                // 如果有按钮，创建按钮
                if (scene.buttons && scene.buttons.length > 0) {
                    scene.buttons.forEach(button => {
                        const btn = document.createElement('button');
                        btn.textContent = button.text;
                        btn.className = `action-button ${button.position}`;
                        btn.addEventListener('click', () => {
                            this.handleButtonClick(button);
                        });
                        document.getElementById('buttons-container').appendChild(btn);
                    });
                } 
                // 如果没有按钮，显示继续按钮
                else if (scene.nextSceneId) {
                    const continueBtn = document.getElementById('continue-button');
                    continueBtn.style.display = 'block';
                    continueBtn.addEventListener('click', () => {
                        this.loadScene(scene.nextSceneId);
                    });
                }
            },
            
            // 处理按钮点击
            handleButtonClick(button) {
                // 如果是正确答案，增加分数
                if (button.isCorrect) {
                    this.score += 6.7;
                    this.correctAnswers++;
                }
                
                // 显示提示（如果有）
                if (button.hint) {
                    const hintBox = document.getElementById('hint-box');
                    hintBox.textContent = button.hint;
                    hintBox.style.display = 'block';
                    
                    // 3秒后隐藏提示并跳转
                    setTimeout(() => {
                        hintBox.style.display = 'none';
                        this.loadScene(button.nextSceneId);
                    }, 3000);
                } 
                // 没有提示直接跳转
                else {
                    this.loadScene(button.nextSceneId);
                }
            },
            
            // 结束游戏
            endGame() {
                this.endTime = new Date();
                
                // 计算用时（秒）
                const timeUsed = Math.floor((this.endTime - this.startTime) / 1000);
                const minutes = Math.floor(timeUsed / 60);
                const seconds = timeUsed % 60;
                
                // 计算时间分数（每分钟2分，不满1分钟1分）
                const timeScore = minutes * 2 + (seconds > 0 ? 1 : 0);
                
                // 计算总得分
                const totalScore = Math.max(0, this.score - timeScore);
                
                // 计算正确率
                const accuracy = (this.correctAnswers / 15 * 100).toFixed(1);
                
                // 显示结果
                document.getElementById('accuracy').textContent = `${accuracy}%`;
                document.getElementById('time-used').textContent = `${minutes}分${seconds}秒`;
                document.getElementById('total-score').textContent = totalScore.toFixed(1);
                
                // 显示结束画面
                document.getElementById('game-container').classList.add('hidden');
                document.getElementById('end-screen').classList.remove('hidden');
            }
        };
        
        // 场景数据
        const scenes = {
            // 第一章
            '2101': {
                backgroundImageId: '01',
                text: '主人公Tom生活在魔法世界的魔法学校里，他每天都_____图书馆。',
                buttons: [
                    {
                        text: '打扫',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2102'
                    },
                    {
                        text: '正在打扫',
                        position: 'right',
                        isCorrect: false,
                        hint: '日常行为用一般现在时',
                        nextSceneId: '2102'
                    }
                ]
            },
            '2102': {
                backgroundImageId: '02',
                text: '有一天，Tom发现他昨天_____的一个箱子今天被打开了，并且里面冒着蓝光。',
                buttons: [
                    {
                        text: '锁上',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2103'
                    },
                    {
                        text: '正在锁上',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述昨天发生的简单行为用一般过去时',
                        nextSceneId: '2103'
                    }
                ]
            },
            '2103': {
                backgroundImageId: '03',
                text: 'Tom好奇，走进一看，是个闪着蓝光的魔法棒，旁白有个标签，写着"时态魔法棒"。',
                nextSceneId: '2104'
            },
            '2104': {
                backgroundImageId: '04',
                text: 'Tom心生好奇，他把魔法棒藏在衣服里，带离了图书馆，准备明天_____户外试一下魔法棒的威力。',
                buttons: [
                    {
                        text: '将去',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2201'
                    },
                    {
                        text: '已经去',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述未来发生的简单行为用一般将来时',
                        nextSceneId: '2201'
                    }
                ]
            },
            
            // 第二章
            '2201': {
                backgroundImageId: '05',
                text: '时间来到第二天早上，他_____着魔法扫帚飞往学习旁边的一个森林里。',
                buttons: [
                    {
                        text: '正在骑',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2202'
                    },
                    {
                        text: '已经骑',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述正在进行的行为用现在进行时',
                        nextSceneId: '2203'
                    }
                ]
            },
            '2202': {
                backgroundImageId: '06',
                text: '昨天这个时候，Tom正_____图书馆，但他觉得这个魔法棒会很好玩，所以决定今天不去打扫图书馆了。',
                buttons: [
                    {
                        text: '正在打扫',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2203'
                    },
                    {
                        text: '已经打扫',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述过去正在进行的行为用过去进行时',
                        nextSceneId: '2202'
                    }
                ]
            },
            '2203': {
                backgroundImageId: '07',
                text: '为了防止图书馆馆长Jimmy发现Tom偷懒，Tom将很早到达将图书馆进行_____。',
                buttons: [
                    {
                        text: '打扫',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2301'
                    },
                    {
                        text: '已经打扫',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述将来正在进行的行为用将来进行时',
                        nextSceneId: '2301'
                    }
                ]
            },
            
            // 第三章
            '2301': {
                backgroundImageId: '08',
                text: 'Tom停在了森林里的小溪旁边，然后从衣服里拿出【一般现在】魔法棒。他想，这魔法棒叫"时态"，难道启动它的咒语和时态有关？',
                buttons: [
                    {
                        text: '拿出',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2302'
                    },
                    {
                        text: '已经拿出',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述日常行为一般现在时',
                        nextSceneId: '2302'
                    }
                ]
            },
            '2302': {
                backgroundImageId: '09',
                text: '于是，他决定结合在魔法学校学习的咒语试一下。Tom用魔法棒指向小溪，念了一句："一条香喷喷的鱼已经被烤熟了【现在完成】"。',
                buttons: [
                    {
                        text: '已经被烤熟',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2303'
                    },
                    {
                        text: '将来被烤熟',
                        position: 'right',
                        isCorrect: false,
                        hint: '咒语未生效，请重新试',
                        nextSceneId: '2302'
                    }
                ]
            },
            '2303': {
                backgroundImageId: '10',
                text: '只见念完咒语之后，突然一道蓝色闪光过后，一个用树枝做的烤架，上面有一条香喷喷的烤鱼出现在了Tom的面前。',
                nextSceneId: '2304'
            },
            '2304': {
                backgroundImageId: '11',
                text: 'Tom想，我来这之前，还没吃东西呢【过去完成】。正好可以包餐一顿。Tom拿起吃了起来。',
                buttons: [
                    {
                        text: '已经烤好的鱼',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2305'
                    },
                    {
                        text: '将要烤好',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述已经完成的的行为用现在完成时',
                        nextSceneId: '2305'
                    }
                ]
            },
            '2305': {
                backgroundImageId: '12',
                text: 'Tom边吃边想，当我掌握了这根魔杖，那个总是欺负我的巫师就会被打败。【将来完成】。（By the time I have mastered this magic wand, the wizard who always bullies me will have been defeated.）',
                buttons: [
                    {
                        text: '将会被打败',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2401'
                    },
                    {
                        text: '已经被打败',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述将来完成的的行为用将来完成时',
                        nextSceneId: '2401'
                    }
                ]
            },
            
            // 第四章
            '2401': {
                backgroundImageId: '13',
                text: '虽然Tom已经来到魔法学校_____一年时间【现在完成进行】，但是魔法的知识还是比不过巫师Mike。',
                buttons: [
                    {
                        text: '学习了',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2402'
                    },
                    {
                        text: '将学习',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述过去的行为持续到现在用现在完成进行',
                        nextSceneId: '2402'
                    }
                ]
            },
            '2402': {
                backgroundImageId: '14',
                text: 'Tom意识到了魔法棒的厉害之处，于是Tom来到了以前经常戏弄他的巫师Mike的家里。Tom说："Mike，现在我_____魔法打败你了，你出来接受我的挑战吧"',
                buttons: [
                    {
                        text: '可以用',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2403'
                    },
                    {
                        text: '正在用',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述正在进行的行为用现在进行时',
                        nextSceneId: '2403'
                    }
                ]
            },
            '2403': {
                backgroundImageId: '15',
                text: '今天是个阳光明媚的日子，只见Mike带着一个大大的灰色巫师帽从房间里走了出来，说到"Tom，在过去的一年时间里，已经多次_____我了【过去完成进行时】。（You had been repeatedly losing to me over the past year.）还是不服输吗"',
                buttons: [
                    {
                        text: '输给',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2404'
                    },
                    {
                        text: '将输给',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述正在进行的行为用现在进行时',
                        nextSceneId: '2404'
                    }
                ]
            },
            '2404': {
                backgroundImageId: '16',
                text: '只见Tom用魔法棒指向天空，用咒语说了一句："It\'s going to rain soon"，魔法棒发出来蓝光。',
                nextSceneId: '2405'
            },
            '2405': {
                backgroundImageId: '17',
                text: '果然，不一会儿天空出现了乌云，打起了雷，开始下起了下雨点。',
                nextSceneId: '2406'
            },
            '2406': {
                backgroundImageId: '18',
                text: 'Mike看见后下了一跳，说到："到明天为止，我已经学了魔法2年了【将来完成进行时】（By tomorrow, I have been studying magic for 2 years now）。却从来没看过这么厉害的魔法，我承认你已经比我厉害了"',
                buttons: [
                    {
                        text: '已经学了',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2407'
                    },
                    {
                        text: '将要学',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述将来完成进行时',
                        nextSceneId: '2407'
                    }
                ]
            },
            '2407': {
                backgroundImageId: '19',
                text: 'Tom想再炫耀一下魔法棒的威力，准备念出下一个咒语时，突然一道光闪过，图书馆馆长Jimmy出现在面前。',
                nextSceneId: '2408'
            },
            '2408': {
                backgroundImageId: '20',
                text: '馆长说到："Tom，我找了它找了一整天，原来被你拿走了"。',
                buttons: [
                    {
                        text: '找了',
                        position: 'left',
                        isCorrect: true,
                        nextSceneId: '2409'
                    },
                    {
                        text: '将找',
                        position: 'right',
                        isCorrect: false,
                        hint: '描述过去完成',
                        nextSceneId: '2409'
                    }
                ]
            },
            '2409': {
                backgroundImageId: '21',
                text: 'Jimmy举起手，魔法棒自动飞到Jimmy的手里。然后，Jimmy领着Tom，说道"赶紧回去给我打扫图书馆".....',
                nextSceneId: '2410'
            },
            '2410': {
                backgroundImageId: '21', // 使用最后一个画面作为结束背景
                text: '',
                nextSceneId: null,
                onLoad: () => gameData.endGame()
            }
        };

        // 页面加载完成后初始化游戏
        window.addEventListener('DOMContentLoaded', () => {
            gameData.init();
            
            // 预加载所有章节图片
            const imageUrls = [];
            for (let i = 1; i <= 21; i++) {
                const paddedNum = i.toString().padStart(2, '0');
                imageUrls.push(`images/画面${paddedNum}.jpg`);
            }
            
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
            });
        });
    </script>
</body>
</html>
