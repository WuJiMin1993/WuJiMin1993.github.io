<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>英语时态魔法游戏</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <div id="game-container">
        <!-- 所有游戏画面容器 -->
        <div id="chapter-screens">
            <!-- 章节1 -->
            <div id="screen-2101" class="screen">
                <img src="images/画面01.jpg" alt="游戏画面01" class="game-image">
                <div class="text-box">
                    <p>Tom lives in a magical world and ____ the school library every day.</p>
                </div>
                <div class="button-container">
                    <button data-next="2102" data-correct="true" class="game-btn answer-btn">cleans</button>
                    <button data-next="2102" data-correct="false" class="game-btn answer-btn">cleaning</button>
                </div>
            </div>

            <div id="screen-2102" class="screen">
                <img src="images/画面02.jpg" alt="游戏画面02" class="game-image">
                <div class="text-box">
                    <p>Tom found that a box he _____ yesterday has been opened today, and there is blue light coming from inside.</p>
                </div>
                <div class="button-container">
                    <button data-next="2103" data-correct="true" class="game-btn answer-btn">locked</button>
                    <button data-next="2103" data-correct="false" class="game-btn answer-btn">locks</button>
                </div>
            </div>

            <div id="screen-2103" class="screen">
                <img src="images/画面03.jpg" alt="游戏画面03" class="game-image">
                <div class="text-box">
                    <p>Tom walked over curiously and saw a magic wand with a flashing blue light, with a label next to it that read: Tense Magic wand.</p>
                </div>
                <div class="button-container">
                    <button data-next="2104" class="game-btn">continue</button>
                </div>
            </div>

            <div id="screen-2104" class="screen">
                <img src="images/画面04.jpg" alt="游戏画面04" class="game-image">
                <div class="text-box">
                    <p>Tom became curious and hid his magic wand in his clothes before taking it away from the library He ____ outdoors tomorrow to test the power of the magic wand.</p>
                </div>
                <div class="button-container">
                    <button data-next="2201" data-correct="true" class="game-btn answer-btn">will go</button>
                    <button data-next="2201" data-correct="false" class="game-btn answer-btn">is going</button>
                </div>
            </div>

            <!-- 章节2 -->
            <div id="screen-2201" class="screen">
                <img src="images/画面05.jpg" alt="游戏画面05" class="game-image">
                <div class="text-box">
                    <p>The next morning, he ____ a magic broom towards a forest next to the school.</p>
                </div>
                <div class="button-container">
                    <button data-next="2202" data-correct="true" class="game-btn answer-btn">is riding</button>
                    <button data-next="2202" data-correct="false" class="game-btn answer-btn">has ridden</button>
                </div>
            </div>

            <div id="screen-2202" class="screen">
                <img src="images/画面06.jpg" alt="游戏画面06" class="game-image">
                <div class="text-box">
                    <p>At this time yesterday, Tom was cleaning the library. He was supposed to be organizing books in the library today, but he thought this magic wand would be fun. So I decided to slack off and not go to the library anymore.</p>
                </div>
                <div class="button-container">
                    <button data-next="2203" data-correct="true" class="game-btn answer-btn">was cleaning</button>
                    <button data-next="2203" data-correct="false" class="game-btn answer-btn">is cleaning</button>
                </div>
            </div>

            <div id="screen-2203" class="screen">
                <img src="images/画面07.jpg" alt="游戏画面07" class="game-image">
                <div class="text-box">
                    <p>Tom will be tidying up the library early tomorrow to prevent library director Jimmy from discovering his laziness.</p>
                </div>
                <div class="button-container">
                    <button data-next="2301" data-correct="true" class="game-btn answer-btn">will be tidying up</button>
                    <button data-next="2301" data-correct="false" class="game-btn answer-btn">is tidying up</button>
                </div>
            </div>

            <!-- 章节3 -->
            <div id="screen-2301" class="screen">
                <img src="images/画面08.jpg" alt="游戏画面08" class="game-image">
                <div class="text-box">
                    <p>Tom stops by the stream in the forest and ____ the magic wand from his clothes. He thought that the magic wand is called a tense magic wand. Is the spell that activates it related to tense?</p>
                </div>
                <div class="button-container">
                    <button data-next="2302" data-correct="true" class="game-btn answer-btn">takes out</button>
                    <button data-next="2302" data-correct="false" class="game-btn answer-btn">will take out</button>
                </div>
            </div>

            <div id="screen-2302" class="screen">
                <img src="images/画面09.jpg" alt="游戏画面09" class="game-image">
                <div class="text-box">
                    <p>So he decided to try combining the spells he learned at the magic school. Tom pointed his magic wand at the stream and said, 'A delicious fish ____.'</p>
                </div>
                <div class="button-container">
                    <button data-next="2304" data-correct="true" class="game-btn answer-btn">has been grilled</button>
                    <button data-next="2304" data-correct="false" class="game-btn answer-btn">will be grilled</button>
                </div>
            </div>

            <div id="screen-2303" class="screen">
                <img src="images/画面10.jpg" alt="游戏画面10" class="game-image">
                <div class="text-box">
                    <p>After reciting the spell, a sudden blue flash appeared. Then a grill made of tree branches appeared in front of Tom, with a fragrant grilled fish on top.</p>
                </div>
                <div class="button-container">
                    <button data-next="2304" class="game-btn">Continue</button>
                </div>
            </div>

            <div id="screen-2304" class="screen">
                <img src="images/画面11.jpg" alt="游戏画面11" class="game-image">
                <div class="text-box">
                    <p>Tom hadn't had breakfast before coming here, and his stomach was growling. Tom ____ the grilled fish and begins eating.</p>
                </div>
                <div class="button-container">
                    <button data-next="2305" data-correct="true" class="game-btn answer-btn">has taken</button>
                    <button data-next="2305" data-correct="false" class="game-btn answer-btn">will take</button>
                </div>
            </div>

            <div id="screen-2305" class="screen">
                <img src="images/画面12.jpg" alt="游戏画面12" class="game-image">
                <div class="text-box">
                    <p>Tom thinks that now he has the powerful wand.And the wizard who always bullies me ____ by him.</p>
                </div>
                <div class="button-container">
                    <button data-next="2401" data-correct="true" class="game-btn answer-btn">will have been defeated</button>
                    <button data-next="2401" data-correct="false" class="game-btn answer-btn">has been defeated</button>
                </div>
            </div>

            <!-- 章节4 -->
            <div id="screen-2401" class="screen">
                <img src="images/画面13.jpg" alt="游戏画面13" class="game-image">
                <div class="text-box">
                    <p>Although Tom ____ magic at the school for a year, his knowledge of magic is still inferior to that of wizard Mike.</p>
                </div>
                <div class="button-container">
                    <button data-next="2402" data-correct="true" class="game-btn answer-btn">has been studying</button>
                    <button data-next="2402" data-correct="false" class="game-btn answer-btn">will studying</button>
                </div>
            </div>

            <div id="screen-2402" class="screen">
                <img src="images/画面14.jpg" alt="游戏画面14" class="game-image">
                <div class="text-box">
                    <p>So Tom came to the house of the wizard Mike who used to tease him. Tom shouted at Mike, 'I ____ magic to defeat you. Come out and accept my challenge.'</p>
                </div>
                <div class="button-container">
                    <button data-next="2403" data-correct="true" class="game-btn answer-btn">will use</button>
                    <button data-next="2403" data-correct="false" class="game-btn answer-btn">am using</button>
                </div>
            </div>

            <div id="screen-2403" class="screen">
                <img src="images/画面15.jpg" alt="游戏画面15" class="game-image">
                <div class="text-box">
                    <p>Mike walked out of the room and said, 'Tom, you ____ to me over the past year. Are you still not willing to give up?'</p>
                </div>
                <div class="button-container">
                    <button data-next="2404" data-correct="true" class="game-btn answer-btn">had been repeatedly losing</button>
                    <button data-next="2404" data-correct="false" class="game-btn answer-btn">was losing</button>
                </div>
            </div>

            <div id="screen-2404" class="screen">
                <img src="images/画面16.jpg" alt="游戏画面16" class="game-image">
                <div class="text-box">
                    <p>Tom pointed his magic wand at the sky and cursed 'It's going to rain soon,' and the wand emitted blue light.</p>
                </div>
                <div class="button-container">
                    <button data-next="2405" class="game-btn">Continue</button>
                </div>
            </div>

            <div id="screen-2405" class="screen">
                <img src="images/画面17.jpg" alt="游戏画面17" class="game-image">
                <div class="text-box">
                    <p>Before long, dark clouds appeared in the sky, thunder started to strike, and raindrops began to fall.</p>
                </div>
                <div class="button-container">
                    <button data-next="2406" class="game-btn">Continue</button>
                </div>
            </div>

            <div id="screen-2406" class="screen">
                <img src="images/画面18.jpg" alt="游戏画面18" class="game-image">
                <div class="text-box">
                    <p>By tomorrow, Mike ____ magic for 2 years now. But Mike was still stunned when he saw Tom's magic. Mike had never seen such a powerful magic before and said to Tom, 'I admit you're already better than me.'</p>
                </div>
                <div class="button-container">
                    <button data-next="2407" data-correct="true" class="game-btn answer-btn">will have been studying</button>
                    <button data-next="2407" data-correct="false" class="game-btn answer-btn">will be studying</button>
                </div>
            </div>

            <div id="screen-2407" class="screen">
                <img src="images/画面19.jpg" alt="游戏画面19" class="game-image">
                <div class="text-box">
                    <p>Tom wants to show off the power of his magic wand again and is ready to recite the next spell. But suddenly a beam of light flashed and the library director Jimmy appeared in front of him.</p>
                </div>
                <div class="button-container">
                    <button data-next="2408" class="game-btn">Continue</button>
                </div>
            </div>

            <div id="screen-2408" class="screen">
                <img src="images/画面20.jpg" alt="游戏画面20" class="game-image">
                <div class="text-box">
                    <p>Library director Jimmy said to Tom, 'I ____ for it all day, but you took it away.'.</p>
                </div>
                <div class="button-container">
                    <button data-next="2409" data-correct="true" class="game-btn answer-btn">have been looking</button>
                    <button data-next="2409" data-correct="false" class="game-btn answer-btn">am looking</button>
                </div>
            </div>

            <div id="screen-2409" class="screen">
                <img src="images/画面21.jpg" alt="游戏画面21" class="game-image">
                <div class="text-box">
                    <p>Jimmy raised his hand, and the magic wand automatically flew into Jimmy's hand. Then Jimmy shouted at Tom, 'Hurry back and clean the library for me.'</p>
                </div>
                <div class="button-container">
                    <button id="game-over-btn" class="game-btn">Game over</button>
                </div>
            </div>

            <!-- 排行榜画面 -->
            <div id="screen-2501" class="screen">
                <div class="room-info">
                    <h2>Room: <span id="room-id-display"></span></h2>
                    <p>Players: <span id="player-count">0</span></p>
                </div>
                <div class="leaderboard-container">
                    <h3>Leaderboard</h3>
                    <table id="leaderboard">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Score</th>
                                <th>Accuracy</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- 排行榜数据将通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 提示信息弹窗 -->
        <div id="message-modal" class="modal">
            <div class="modal-content">
                <p id="message-text"></p>
            </div>
        </div>
    </div>

    <script>
        // 初始化Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDHRYTBU74r31MPYVAAnRMwKM76c_-BduQ",
            authDomain: "tetrisonline-ca400.firebaseapp.com",
            projectId: "tetrisonline-ca400",
            storageBucket: "tetrisonline-ca400.appspot.com",
            messagingSenderId: "58207939196",
            appId: "1:58207939196:web:b34f403204096084ee37f9",
            measurementId: "G-GG7GNEQ718"
        };

        // 初始化Firebase应用
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 从URL获取参数
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('room');
        const playerId = urlParams.get('player');
        const isTeacher = urlParams.get('teacher') === 'true';

        // 游戏状态变量
        let currentScreenId = null;
        let gameStarted = false;
        let startTime = null;
        let correctAnswers = 0;
        let playerDataRef = null;
        let roomRef = null;
        let playerNickname = '';
        let playerFinished = false;

        // DOM元素
        const chapterScreens = document.getElementById('chapter-screens');
        const screens = document.querySelectorAll('.screen');
        const messageModal = document.getElementById('message-modal');
        const messageText = document.getElementById('message-text');
        const gameOverBtn = document.getElementById('game-over-btn');
        const answerButtons = document.querySelectorAll('.answer-btn');
        const roomIdDisplay = document.getElementById('room-id-display');
        const playerCountDisplay = document.getElementById('player-count');
        const leaderboardBody = document.getElementById('leaderboard-body');

        // 显示消息弹窗
        function showMessage(message, duration = 3000) {
            messageText.textContent = message;
            messageModal.style.display = 'flex';
            
            if (duration > 0) {
                setTimeout(() => {
                    messageModal.style.display = 'none';
                }, duration);
            }
        }

        // 隐藏消息弹窗
        function hideMessage() {
            messageModal.style.display = 'none';
        }

        // 显示指定屏幕
        function showScreen(screenId) {
            // 隐藏所有屏幕
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            
            // 显示目标屏幕
            const targetScreen = document.getElementById(`screen-${screenId}`);
            if (targetScreen) {
                targetScreen.classList.add('active');
                currentScreenId = screenId;
                
                // 更新游戏进度
                updateProgress(screenId);
                
                // 预加载下一张图片
                preloadNextImage(screenId);
            } else {
                console.error(`Screen with ID ${screenId} not found`);
            }
        }

        // 更新游戏进度
        function updateProgress(screenId) {
            if (!playerDataRef || isTeacher || playerFinished) return;
            
            // 计算进度 (1-21)
            let progress = 0;
            const screenNum = parseInt(screenId);
            
            if (screenNum >= 2101 && screenNum <= 2104) {
                progress = screenNum - 2100;
            } else if (screenNum >= 2201 && screenNum <= 2203) {
                progress = 4 + (screenNum - 2200);
            } else if (screenNum >= 2301 && screenNum <= 2305) {
                progress = 7 + (screenNum - 2300);
            } else if (screenNum >= 2401 && screenNum <= 2409) {
                progress = 12 + (screenNum - 2400);
            } else if (screenNum === 2501) {
                progress = 21;
            }
            
            // 计算百分比
            const progressPercent = Math.round((progress / 21) * 100);
            
            // 更新数据库
            playerDataRef.update({
                progress: progressPercent
            }).catch(error => {
                console.error('更新进度失败:', error);
            });
        }

        // 预加载下一张图片
        function preloadNextImage(screenId) {
            const nextScreenId = getNextScreenId(screenId);
            if (!nextScreenId) return;
            
            const nextScreen = document.getElementById(`screen-${nextScreenId}`);
            if (!nextScreen) return;
            
            const img = nextScreen.querySelector('.game-image');
            if (!img) return;
            
            const imgSrc = img.getAttribute('src');
            if (!imgSrc) return;
            
            // 创建新的Image对象预加载
            const preloadImg = new Image();
            preloadImg.src = imgSrc;
        }

        // 获取下一个屏幕ID
        function getNextScreenId(screenId) {
            const screenNum = parseInt(screenId);
            
            // 如果是最后一个屏幕，返回null
            if (screenNum === 2501) return null;
            
            // 查找当前屏幕的按钮，获取下一个屏幕ID
            const currentScreen = document.getElementById(`screen-${screenId}`);
            if (!currentScreen) return null;
            
            const buttons = currentScreen.querySelectorAll('button');
            if (buttons.length === 0) return null;
            
            // 返回第一个按钮的data-next属性
            return buttons[0].getAttribute('data-next');
        }

        // 初始化游戏
        function initGame() {
            // 如果是老师，直接显示排行榜
            if (isTeacher) {
                showScreen('2501');
                initLeaderboard();
                return;
            }
            
            // 检查必要参数
            if (!roomId || !playerId) {
                showMessage('缺少必要参数，将返回首页', 3000);
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
                return;
            }
            
            // 设置房间信息显示
            roomIdDisplay.textContent = roomId;
            
            // 初始化Firebase引用
            roomRef = database.ref('rooms/' + roomId);
            playerDataRef = database.ref('rooms/' + roomId + '/players/' + playerId);
            
            // 获取玩家昵称
            playerDataRef.once('value').then(snapshot => {
                const playerData = snapshot.val();
                if (playerData) {
                    playerNickname = playerData.nickname || '';
                    
                    // 如果玩家已经完成游戏，直接显示排行榜
                    if (playerData.finished) {
                        playerFinished = true;
                        showScreen('2501');
                        initLeaderboard();
                        return;
                    }
                }
                
                // 开始游戏
                startGame();
            }).catch(error => {
                console.error('获取玩家数据失败:', error);
                showMessage('获取玩家数据失败，将返回首页', 3000);
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            });
        }

        // 开始游戏
        function startGame() {
            // 记录开始时间
            startTime = Date.now();
            gameStarted = true;
            
            // 更新玩家状态
            playerDataRef.update({
                startTime: startTime,
                finished: false
            }).catch(error => {
                console.error('更新玩家状态失败:', error);
            });
            
            // 开始计时器
            startTimer();
            
            // 显示第一个屏幕
            showScreen('2101');
            
            // 初始化排行榜监听
            initLeaderboard();
        }

        // 开始计时器
        function startTimer() {
            setInterval(() => {
                if (!gameStarted || playerFinished) return;
                
                const currentTime = Date.now();
                const timeSpent = Math.floor((currentTime - startTime) / 1000); // 秒
                
                // 更新数据库中的用时
                playerDataRef.update({
                    timeSpent: timeSpent
                }).catch(error => {
                    console.error('更新时间失败:', error);
                });
            }, 3000); // 每3秒更新一次
        }

        // 初始化排行榜
        function initLeaderboard() {
            if (!roomRef) return;
            
            // 监听房间数据变化
            roomRef.on('value', (snapshot) => {
                const roomData = snapshot.val();
                if (!roomData) return;
                
                // 更新玩家数量
                const players = roomData.players || {};
                const playerCount = Object.keys(players).length;
                playerCountDisplay.textContent = playerCount;
                
                // 准备排行榜数据
                const leaderboardData = [];
                
                for (const [id, player] of Object.entries(players)) {
                    if (player.finished) {
                        // 计算分数
                        const score = calculateScore(player.correctAnswers, player.timeSpent);
                        const accuracy = calculateAccuracy(player.correctAnswers);
                        
                        leaderboardData.push({
                            id: id,
                            nickname: player.nickname || 'Unknown',
                            score: score,
                            accuracy: accuracy,
                            timeSpent: formatTime(player.timeSpent),
                            isCurrentPlayer: id === playerId
                        });
                    }
                }
                
                // 按分数排序
                leaderboardData.sort((a, b) => b.score - a.score);
                
                // 只保留前10名
                const top10 = leaderboardData.slice(0, 10);
                
                // 更新排行榜
                updateLeaderboard(top10);
            });
        }

        // 计算分数
        function calculateScore(correctCount, timeSpent) {
            // 每题6.7分
            const questionScore = correctCount * 6.7;
            
            // 时间分数：每分钟2分
            const timeScore = Math.floor(timeSpent / 60) * 2 + (timeSpent % 60 > 0 ? 1 : 0);
            
            // 总分数 = 问题分数 - 时间分数
            let totalScore = questionScore - timeScore;
            
            // 确保分数在0-100之间
            totalScore = Math.max(0, Math.min(100, Math.round(totalScore)));
            
            return totalScore;
        }

        // 计算正确率
        function calculateAccuracy(correctCount) {
            // 总共15题
            const accuracy = (correctCount / 15) * 100;
            return accuracy.toFixed(1) + '%';
        }

        // 格式化时间
        function formatTime(seconds) {
            if (!seconds) return '0:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // 更新排行榜
        function updateLeaderboard(data) {
            // 清空现有内容
            leaderboardBody.innerHTML = '';
            
            // 添加新数据
            data.forEach((player, index) => {
                const row = document.createElement('tr');
                
                // 如果是当前玩家，高亮显示
                if (player.isCurrentPlayer) {
                    row.classList.add('current-player');
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player.nickname}</td>
                    <td>${player.score}</td>
                    <td>${player.accuracy}</td>
                    <td>${player.timeSpent}</td>
                `;
                
                leaderboardBody.appendChild(row);
            });
        }

        // 处理答案按钮点击
        function handleAnswerClick(event) {
            const button = event.currentTarget;
            const isCorrect = button.getAttribute('data-correct') === 'true';
            const nextScreenId = button.getAttribute('data-next');
            
            // 禁用按钮，防止重复点击
            button.disabled = true;
            
            // 更新正确答案计数
            if (isCorrect) {
                correctAnswers++;
                
                // 更新数据库中的正确答题数
                if (playerDataRef) {
                    playerDataRef.update({
                        correctAnswers: correctAnswers
                    }).catch(error => {
                        console.error('更新正确答题数失败:', error);
                    });
                }
            } else {
                // 显示错误提示
                const errorMessages = {
                    '2101': 'Daily behavior is expressed in the present tense',
                    '2102': 'Describe the simple behavior that occurred yesterday in the past simple tense',
                    '2104': 'Describe simple behaviors that will occur in the future using general future tense',
                    '2201': 'Describe the ongoing behavior in present continuous tense',
                    '2202': '描述过去正在进行的行为用过去进行时',
                    '2203': 'Describe the ongoing behavior in the future using future continuous tense',
                    '2301': 'Describe daily behavior in the present tense',
                    '2302': 'The spell didn\'t take effect, Tom recited a delicious fish that had already been grilled',
                    '2304': 'Describe completed actions in present perfect tense',
                    '2305': 'Describe the behavior to be completed in the future using the future perfect tense',
                    '2401': 'The action has been ongoing from the past to the present, and may have just ended or is still ongoing, using the present to complete the ongoing tense',
                    '2402': 'Describe future actions using future continuous tense',
                    '2403': 'A certain past action started earlier in the past and continued until a certain point in time, possibly still continuing or just stopped',
                    '2406': 'Emphasize how long a certain action has been ongoing until a certain point in the future, using the future completion continuous time',
                    '2408': 'Describe actions that have been completed in the past and use them to complete them'
                };
                
                const currentScreenId = parseInt(currentScreenId);
                const errorMessage = errorMessages[currentScreenId] || 'Incorrect answer';
                showMessage(errorMessage, 3000);
            }
            
            // 延迟跳转到下一个屏幕
            setTimeout(() => {
                showScreen(nextScreenId);
            }, isCorrect ? 0 : 3000);
        }

        // 处理游戏结束
        function handleGameOver() {
            if (playerFinished) return;
            
            playerFinished = true;
            
            // 计算最终用时
            const endTime = Date.now();
            const timeSpent = Math.floor((endTime - startTime) / 1000);
            
            // 计算最终分数
            const score = calculateScore(correctAnswers, timeSpent);
            const accuracy = calculateAccuracy(correctAnswers);
            
            // 更新玩家状态为已完成
            playerDataRef.update({
                finished: true,
                timeSpent: timeSpent,
                score: score,
                accuracy: accuracy,
                endTime: endTime
            }).then(() => {
                // 显示排行榜
                showScreen('2501');
            }).catch(error => {
                console.error('更新玩家完成状态失败:', error);
                showMessage('提交成绩失败', 3000);
            });
        }

        // 初始化按钮事件
        function initButtons() {
            // 答案按钮
            document.querySelectorAll('.answer-btn').forEach(button => {
                button.addEventListener('click', handleAnswerClick);
            });
            
            // 普通按钮（非答案按钮）
            document.querySelectorAll('.game-btn:not(.answer-btn)').forEach(button => {
                button.addEventListener('click', (event) => {
                    const nextScreenId = button.getAttribute('data-next');
                    if (nextScreenId) {
                        showScreen(nextScreenId);
                    }
                });
            });
            
            // 游戏结束按钮
            if (gameOverBtn) {
                gameOverBtn.addEventListener('click', handleGameOver);
            }
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            initButtons();
            initGame();
        });
    </script>
</body>
</html>
